---
title: "ETC5521 Assignment 1"
subtitle: "Amusement Park injuries"
team: "bilby"
author:
  - "Yuheng Cui"
  - "Jimmy Effendy"
date: "`r Sys.Date()`"
output: 
  bookdown::html_document2
bibliography: references.bib
biblio-style: authoryear-comp
---

[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.align = "center")
library(dplyr)
library(visdat)
library(readr)
library(tidyverse)
library(lubridate)
library(knitr)
library(kableExtra)
library(tidytext)
library(wordcloud)
```

```{r rawData, include = FALSE}
tx_injuries <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-09-10/tx_injuries.csv")


safer_parks <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-09-10/saferparks.csv")
```

# Introduction and Motivation

Families and friends tend to spend their holidays and weekends in amusement parks. The popularity of amusement park has been growing in popularity in recent years, with worldwide attendance at the top 10 amusement park groups reached half a billion mark for the first time last year [@schneider_2019], with 4% year-on-year growth [@tea2019].

With this ever increasing popularity, it is therefore not unreasonable to consider that the safety of amusement rides is a subject to substantial public interests [@WOODCOCK2019171]. It was estimated that the annual number of ride-related injuries in North America was 1,289 in 2018; which is 26% higher compared to 2017 [@ipaa_2018]. International Association of Amusement Parks and Attractions further stated that approximately 11% of those injuries are "serious", meaning they result in urgent admission and hospitalization for more than 24 hours for non-medical observation reasons, or causes fatality.

While accidents occurred in amusement parks are arguably not frequent, they generate prominent effects when they happen. International Association of Amusement Parks and Attractions [@-iaapa_2017] reported that following a ride malfunction in Australia killing four people, the park and also other venues in Australia suffer considerable declines in attendance. This shows that public confidence, safety, and commercial feasibility are strongly linked [@WOODCOCK2019171].

There are 25 amusement parks in Texas already [@wiki]. Indeed, amusement parks are good place for kids and young people, but there are also much news reporting accidents in amusement park, and some news are horrible. These news remind people to take care of themselves when playing. More importantly, amusement parks should reduce the probability of mechanical failure and operation errors.

Thorough evaluations to injury records related to amusement parks are aligned with public interests and are integral to encourage constant improvement. This paper intends to find factors that have major influence to amusement ride accidents. Uncovering this insight may encourage amusement park owners to utilize their resources more wisely in favor of those groups or equipment that are at the most risk. In addition, this report may also facilitate regulatory bodies in developing safety standards and regulations.

This study intends to find out the patterns within injuried groups. The patterns refer to the high-risk groups, high-risk equipment and seasonal trend of injuries. We believe amusement park must make the effort to reduce the incidents; the effort refers to maintaining equipments, training staff and monitoring visitors. At same time, visitors should also follow the parks regulations and equipment instructions. After all, visitors should be responsible for their own safeties in the first place. Reduce the injuries occur in amusement parks and increase the well beings of society. 

Firstly, description of data used in the report and how it is prepared for analysis will be discussed. Then, analysis and findings acquired from the data set will be presented and discussed.

# Data Description

The datasets are downloaded from [here](https://github.com/rfordatascience/tidytuesday/tree/master/data/2019/2019-09-10) from GitHub. There are two datasets provided in the repository; one originated from [data.world](https://data.world/amillerbernd/texas-amusement-park-accidents) and another from [Saferparks database](https://ridesdatabase.org/saferparks/data/).

The data.world data set originated from Texas Department of Insurance (TDI) [@dataworld]. It is a record of any injuries caused by an amusement ride from February the 1st 2013 to February the 1st 2017 occurring in the State of Texas (data.world, 2020). An amusement ride is "any mechanical, gravity, or water device or devices that carry or convey passengers along, around, or over a fixed or restricted route or course or within a defined area for the purpose of giving its passengers amusement, pleasure, or excitement" [@tdi]. According to TDI [-@tdi], a quarterly injury report needed to be submitted by amusement ride owners and operators. TDI further stated that this record relates to any injuries that require medical treatment or result in death. 

This data set has `r nrow(tx_injuries)` number of observations and `r ncol(tx_injuries)` number of variables. Fig \@ref(fig:quality-of-tx) shows the data set has too many missing values in **other** variable and many missing values in **serial_no** variable. Good news is that these two variables has little effects on our analysis, thus, we can remove these two variables. **Age** should be converted to numeric variable and **injury_date** should be date variable.

```{r quality-of-tx, fig.cap = "Texas amusement parks dataset"}
vis_dat(tx_injuries)
```

The accidents records in the Saferparks data set, on the other hand, originated from the U.S. State and Federal safety agencies regulating amusement rides [@saferparks]. Saferparks achieved this by submitting public records requests to those agencies (both federal and states agencies). In some cases, additional requests were submitted to specific agencies to achieve particular goals [@saferparks]. As a result, Saferparks needs to harmonize these data sets into their database.  

It has `r nrow(safer_parks)` observations and `r ncol(safer_parks)` variables. Fig \@ref(fig:quality-of-safer) shows 4 variables have too many missing values to be analysed, therefore, we ought to ignore them. **acc_date** should be converted to date variable. Although **manufacturer** has many missing values as well, we decided to keep it because it may be insightful.

```{r quality-of-safer, fig.cap = "Saferparks dataset"}
vis_dat(safer_parks)
```

## Data Limitation

According to Saferparks [-@saferparks], reporting criteria and its level of details, types of equipment included, and years covered vary widely by year, industry sector, jurisdictions, and other factors [@saferparks]. 

While the data set can be used to uncover insights of how patrons are hurt in amusement rides, Saferparks do not recommend the data set to be used for comparison across states, parks, rides or years [@saferparks].

Despite the missing value issue, the Saferparks data set has two major limitations [@saferpark]:

* The data varies widely in content and consistency, because only half of U.S states have provided accident data
* States with stronger government oversight tend to log more accidents.

After all, the data set still provides some insights about amusement park injury, although it could not be used for predicting nation-wide patterns.


## Data Cleaning and Transformation

*possibly need to convert some variables to factors*

```{r clean}
tx_injuries %>% 
  select(-other, -serial_no, -injury_report_rec) %>% 
  mutate(age = as.numeric(age),
         injury_date = as.Date(injury_date, format = "%m/%d/%Y")) # convert to date?
```

# Analysis and findings

## Primary question: what are the high-risk groups?

The primary question in this report is to find out the high-risk group. Consequently, draw parks attention to pay more attention on these groups for their safety. We mainly analyse the age and gender for the primary quesiton. The Saferparks dataset cannot be used here, because the dataset record injury records instead of individuals; that is, we do not know the ages of each injuried. 

First, we need to clean the data. The missing values in age and gender is removed and the variable type is converted from character to numeric. Second, we unify the records in gender because some observations record gender male as 'M' while others record as 'm'. Third, calculate the percentage of each age group.

```{r tx-pm1, fig.cap = "Bar plot for age"}
tx_gender_age <- tx_injuries %>%
  # remove missing values in gender
  filter(!is.na(gender)) %>% 
  mutate(gender = recode(gender,
                         "m" = "M",
                         "f" = "F",
                         "n/a" = "unknown",
                         "N/A" = "unknown")) %>% # unify gender record
  mutate(age = as.numeric(age)) %>% 
    # remove missing values in age
  filter(!is.na(age))

  
   

tx_ob <- nrow(tx_gender_age)
  
# tx_gender_age %>% 
#   count(age, sort = FALSE) %>% 
#   mutate(percentage = n*100/tx_ob) %>% 
#   ggplot(aes(x = age, y = percentage)) + 
#   geom_line() +
#   geom_hline(yintercept = 1, color = 'red') # This line plot is removed.

tx_gender_age%>% 
  group_by(gender, age) %>% 
  count(gender,age) %>% 
  ungroup() %>% 
  mutate(percent = round(n*100/tx_ob, 2)) %>% 
  select(-n) %>% 
  ggplot(aes(x = age, y = percent, fill = gender)) +
  geom_bar(stat="identity")+
  # geom_text(aes(y=label_ypos, label=percent), vjust=1.6, 
  #           color="white", size=3.5)+
  # scale_fill_brewer(palette="Paired")+
  theme_minimal()
```

Fig \@ref(fig:tx-pm1) illustrates the distribution of injuried ages and gender. Surprisingly, the most injuried were babies. (more...)


```{r tx-pm1-tab}
tx_gender_age %>% 
  group_by(age) %>% 
  count() %>% 
  mutate(percent = n*100/tx_ob) %>% 
  arrange(-percent) %>% 
  select(-n) %>% 
  head(10) %>% 
  kable(caption = "Top 10 risky age group in amusement parks in Texas") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r tx-pm1-gender}
tx_gender_age%>% 
  group_by(gender, age) %>% 
  count(gender,age) %>% 
  ungroup() %>% 
  mutate(percent = round(n*100/tx_ob, 2)) %>% 
  select(-n) %>% 
  arrange(-percent) %>% 
  head(10) %>% 
  kable(caption = "Top 10 risky group by gender in amusement parks in Texas") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"))
```



```{r tx-pm1-pct, include = FALSE}
tx_kid <- tx_gender_age %>% 
  group_by(age) %>% 
  count() %>% 
  mutate(percent = n*100/tx_ob) %>% 
  arrange(-percent) %>% 
  ungroup() %>% 
  filter(age < 18 & age > 0) %>% 
  pull(percent) %>% 
  sum()

tx_kid_fe <- tx_gender_age%>% 
  group_by(gender, age) %>% 
  count(gender,age) %>% 
  ungroup() %>% 
  mutate(percent = round(n*100/tx_ob, 2)) %>% 
  filter(gender == "F" & age < 18 & age >0) %>% 
  pull(percent) %>% 
  sum()

tx_kid_m <- tx_kid - tx_kid_fe
```

Table \@ref(tab:tx-pm1-tab) shows the ranking of injuried ages. Injuried babies occupies nearly 10% of the dataset. In the dataset `r round(tx_kid, 2)` percent injuried are under 18, except babies. We distinguish babies from other age groups because babies are carried by their parents and babies are not able to move to any places by their own. 

If we take gender into account, we can see gender distributions by age. Table \@ref(tab:tx-pm1-gender) shows the top-10 rankings by gender and age. In top-10 list, it seems that more girls get injuried than boys in amusement parks in Texas. However, if we look at the whole dataset, age between  1 and 16, `r round(tx_kid_fe, 2)` percent are girls while `r round(tx_kid_m, 2)` are boys.

In summary, parents really need to pay more attention on their babies in amusement parks. And any children (under 18) need to draw the parks staff's attention. 


## Secondary question1: what is the most dangerous equipment in parks and what is the most body parts injuried?

First secondary question is "what is the most dangerous equipment in parks". We count the total number of injuries by device type. Table \@ref(tab:safer-equip) shows top-10 rankings of high-risk equipment. It is not surprising that roller coaster is the equipment that causes the most injuries. @gutierrez reported that seven cases are related to roller coaster among eight high-profile U.S. amusement park deaths before 2016. 

```{r safer-equip}
safer_parks %>% 
  group_by(device_type) %>% 
  summarise(tot_num_injuries = sum(num_injured)) %>% 
  arrange(-tot_num_injuries) %>% 
  head(10) %>% 
  kable(caption = "Top 10 risky device type") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r sq1-wordcloud, fig.cap = "Injury description --- word cloud", out.height= '100%', out.width= '100%'}
data(stop_words)
safer_parks %>% 
  select(injury_desc) %>% 
  unnest_tokens(word, injury_desc) %>% 
  anti_join(stop_words) %>% 
  count(word) %>% 
  with(wordcloud(word, n ,max.words = 80))

```

Fig \@ref(fig:sq1-wordcloud) shows the frequent words in injury description. Ignoring the words "injury" and "pain", we can see that head, neck knee, ankle, shoulder frequently appear.

In summary, amusement parks should pay extra attention on roller coaster because unlike other subjects roller coaster's failure can cause severe consequence. First, they should regularly maintain the roller coaster, in order to reduce mechanical failure. Second, train the staff and ask them to check to-do list every time launch the equipments. Third, ask visitors to follow the safety requirements. Furthermore, visitors should also protect their head, neck and shoulder. Those body parts are vulnerable and important and they are always injuried in amusement park injury cases.

# Acknowledgments
The following packages are used to produce this report:
visdat [@visdat], dplyr [@dplyr], readr[@readr], tidyverse [@tidyverse], lubridate [@lubridate], knitr [@knitr], kableExtra [@kableExtra], tidytext [@tidytext], wordcloud [@wordcloud]


# References


