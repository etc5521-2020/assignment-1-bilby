---
title: "ETC5521 Assignment 1"
subtitle: "Amusement Park injuries"
team: "bilby"
author:
  - "Yuheng Cui"
  - "Jimmy Effendy"
date: "`r Sys.Date()`"
output: 
  bookdown::html_document2
---

[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.align = "center")
library(dplyr)
library(visdat)
library(readr)
library(tidyverse)
library(lubridate)
library(knitr)
library(kableExtra)
```

```{r rawData, include = FALSE}
tx_injuries <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-09-10/tx_injuries.csv")


safer_parks <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-09-10/saferparks.csv")
```

# Introduction and motivation

intro: ...

motivation: study the injuries record, find out the risky groups. In the future, amusement parks can pay more attention on those groups and entertaining equipments. Consequently, reduce the injuries occur in amusement parks and increase the well beings of society.

# Data description

The datasets are downloaded from [here](https://github.com/rfordatascience/tidytuesday/tree/master/data/2019/2019-09-10) from GitHub. There are two datasets provided in the repository; one originated from [data.world](https://data.world/amillerbernd/texas-amusement-park-accidents) and another from [Safer Parks database](https://ridesdatabase.org/saferparks/data/).

The data.world dataset is about all incidents occurred at amusement parks in Texas in 1st of February 2013 to 1st of February 2017 recorded by Texas Department of Insurance (data.world, 2020). This dataset has `r dim(tx_injuries)[1]` number of observations and `r dim(tx_injuries)[2]` number of variables. Fig \@ref(fig:quality-of-tx) shows the dataset has too many missing values in **other** variable and many missing values in **serial_no** variable. Good news is that these two variables has little effects on our analysis, thus, we can remove these two variables. **Age** should be converted to numeric variable and **injury_date** should be date variable.

```{r quality-of-tx, fig.cap = "Texas amusement parks dataset"}
vis_dat(tx_injuries)
```

The accidents records in the Saferparks dataset, on the other hand, originated from the U.S. state and federal safety agencies regulating amusement rides (Saferparks, 2020). It has `r dim(safer_parks)[1]` observations and `r dim(safer_parks)[2]` variables. Fig \@ref(fig:quality-of-safer) shows 4 variables have too many missing values to be analysed, therefore, we ought to ignore them. **acc_date** should be converted to date variable. Although **manufacturer** has many missing values as well, we decided to keep it because it may be insightful.

```{r clean}
tx_injuries %>% 
  select(-other, -serial_no, -injury_report_rec) %>% 
  mutate(age = as.numeric(age),
         injury_date = as.Date(injury_date, format = "%m-%d-%Y")) # convert to date?
```

```{r quality-of-safer, fig.cap = "Saferparks dataset"}
vis_dat(safer_parks)
```

# Analysis and findings

## Primary question: what is the characteristics of high-risk group?

```{r tx-pm1, fig.cap = "Line plot for age"}
tx_gender_age <- tx_injuries %>%
  # remove missing values in gender
  filter(!is.na(gender)) %>% 
  mutate(gender = recode(gender,
                         "m" = "M",
                         "f" = "F")) %>% # unify gender format
  mutate(age = as.numeric(age)) %>%
  # remove missing values in age
  filter(!is.na(age)) 

tx_ob <- nrow(tx_gender_age)
  
tx_gender_age %>% 
  count(age, sort = FALSE) %>% 
  mutate(percentage = n*100/tx_ob) %>% 
  ggplot(aes(x = age, y = percentage)) + 
  geom_line() +
  geom_smooth()
```


```{r tx-pm1-tab}
tx_gender_age %>% 
  group_by(age) %>% 
  count() %>% 
  arrange(-n) %>% 
  head(10) %>% 
  kable(caption = "Top 10 risky age group") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r tx-pm1-gender}
tx_gender_age%>% 
  group_by(gender, age) %>% 
  count(gender,age) %>% 
  ungroup() %>% 
  mutate(percent = round(n*100/tx_ob, 2)) %>% 
  select(-n) %>% 
  arrange(-percent) %>% 
  head(10) %>% 
  kable(caption = "Top 10 risky group") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"))
```


## Secondary question1: The most dangerous equipment in parks


# References
